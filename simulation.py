# -*- coding: utf-8 -*-
"""
Created on Thu Dec  6 15:49:39 2018

@author: Lucus
"""
import firebase_admin
from firebase_admin import credentials
from firebase_admin import firestore
from google.cloud.firestore_v1beta1._helpers import GeoPoint
import time

cred = credentials.Certificate("C:/Users/Lucus/Desktop/ambu-50001-firebase-adminsdk-gzojc-d53b55fabd.json")
firebase_admin.initialize_app(cred)

db = firestore.client()

#rawpts = [[1.34127,103.96385], [1.34132,103.96389], [1.34142,103.96393], [1.34142,103.96393], [1.34138,103.96405], [1.34138,103.96409], [1.34139,103.96412], [1.34142,103.96417], [1.34143,103.96421], [1.34143,103.96421], [1.34142,103.96422], [1.3414,103.96424], [1.34132,103.96434], [1.34119,103.96451], [1.34118,103.96453], [1.34116,103.96455], [1.34115,103.96456], [1.34114,103.96457], [1.34112,103.96457], [1.3411,103.96458], [1.34109,103.96458], [1.34106,103.96458], [1.34099,103.96458], [1.34076,103.96457], [1.34059,103.96457], [1.34057,103.96458], [1.34054,103.96458], [1.34053,103.96459], [1.34052,103.9646], [1.34049,103.96464], [1.34045,103.9647], [1.34032,103.96489], [1.34029,103.96493], [1.34026,103.96496], [1.34023,103.96499], [1.34019,103.96503], [1.34013,103.96509], [1.34009,103.96514], [1.34006,103.96518], [1.34002,103.96525], [1.34002,103.96525], [1.34032,103.96546], [1.34042,103.96553], [1.34048,103.96559], [1.34054,103.96564], [1.34064,103.96573], [1.34079,103.96588], [1.34091,103.96601], [1.34101,103.96613], [1.34108,103.96623], [1.34112,103.96631], [1.34115,103.96639], [1.34119,103.96648], [1.3417,103.96745], [1.3418,103.96777], [1.3418,103.96777], [1.34189,103.96784], [1.34192,103.96786], [1.34196,103.96788], [1.34205,103.96792], [1.34216,103.96791], [1.34224,103.9679], [1.34236,103.96787], [1.34242,103.96785], [1.34246,103.96783], [1.34257,103.96776], [1.34261,103.96775], [1.34267,103.96773], [1.34279,103.96771], [1.34293,103.96768], [1.34309,103.96766], [1.34317,103.96766], [1.34324,103.96766], [1.34329,103.96767], [1.34335,103.96769], [1.34338,103.96771], [1.3434,103.96772], [1.34341,103.96774], [1.34344,103.96778], [1.34347,103.96784], [1.34348,103.96787], [1.34348,103.9679], [1.34347,103.96793], [1.34345,103.96796], [1.34345,103.96798], [1.34344,103.96799], [1.34343,103.968], [1.34341,103.96801], [1.34339,103.96802], [1.34337,103.96802], [1.34325,103.96803], [1.34314,103.96803], [1.34291,103.96805], [1.34277,103.96805], [1.3427,103.96806], [1.34265,103.96805], [1.3426,103.96805], [1.34256,103.96804], [1.34253,103.96803], [1.34248,103.968], [1.34244,103.96799], [1.34241,103.96798], [1.34237,103.96798], [1.34223,103.96798], [1.34206,103.96799], [1.34185,103.968], [1.34185,103.968], [1.34178,103.96801], [1.34177,103.96794], [1.34175,103.96787], [1.34171,103.96773], [1.34165,103.96758], [1.34162,103.9675], [1.34158,103.96743], [1.34139,103.96704], [1.34131,103.9669], [1.3412,103.96667], [1.34114,103.96655], [1.34111,103.96651], [1.34111,103.96648], [1.3411,103.96642], [1.34109,103.96637], [1.34105,103.9663], [1.34099,103.96622], [1.34093,103.96614], [1.34087,103.96606], [1.34077,103.96596], [1.34071,103.96589], [1.34051,103.9657], [1.3404,103.96561], [1.3403,103.96553], [1.34019,103.96545], [1.34008,103.96537], [1.33996,103.96529], [1.33978,103.96518], [1.33947,103.965], [1.33932,103.96488], [1.33932,103.96488], [1.33927,103.96485], [1.3393,103.96481], [1.33944,103.96461], [1.3395,103.96451], [1.33954,103.96442], [1.33958,103.96431], [1.3396,103.96424], [1.33963,103.96414], [1.33964,103.96403], [1.33965,103.96392], [1.33962,103.96352], [1.33959,103.96298], [1.33956,103.96263], [1.33956,103.96249], [1.33957,103.96236], [1.33957,103.96222], [1.33958,103.96206], [1.3396,103.96184], [1.33966,103.96152], [1.33968,103.96135], [1.33977,103.96102], [1.33977,103.96102], [1.33981,103.96086], [1.3399,103.96054], [1.33997,103.96032], [1.34007,103.96009], [1.34019,103.95987], [1.34032,103.95967], [1.34048,103.95948], [1.34064,103.95931], [1.34081,103.95914], [1.34115,103.95891], [1.34216,103.95823], [1.34223,103.95818], [1.34267,103.95792], [1.34287,103.95783], [1.34295,103.95779], [1.34309,103.95774], [1.3432,103.95771], [1.34329,103.95768], [1.34349,103.95764], [1.34355,103.95763], [1.34377,103.95762], [1.34383,103.95762], [1.34387,103.95762], [1.34392,103.95763], [1.34406,103.95764], [1.34443,103.95766], [1.34443,103.95766], [1.34448,103.95702], [1.3445,103.95665], [1.3445,103.95652], [1.34448,103.95639], [1.34443,103.95626], [1.34438,103.95615], [1.34431,103.95606], [1.34424,103.95597], [1.34417,103.95588], [1.34398,103.95566], [1.34361,103.95521], [1.34332,103.95489], [1.34318,103.95472], [1.3428,103.95428], [1.34254,103.95396], [1.34251,103.95392], [1.34223,103.95358], [1.34209,103.95341], [1.34199,103.9533], [1.34191,103.95322], [1.34161,103.95289], [1.34114,103.95232], [1.34104,103.95221], [1.34102,103.95218], [1.34099,103.95215], [1.34093,103.95206], [1.34075,103.95184], [1.34005,103.95102], [1.34002,103.95093], [1.33978,103.95061], [1.33972,103.95054], [1.33949,103.95024], [1.33949,103.95024], [1.33939,103.95012], [1.33952,103.95003], [1.33964,103.94993], [1.33966,103.94983], [1.33967,103.94977], [1.33969,103.9497], [1.33971,103.94967], [1.33971,103.94965], [1.33974,103.94962], [1.33979,103.94959], [1.33988,103.94956], [1.33988,103.94956], [1.33992,103.94958], [1.33995,103.94959], [1.33996,103.9496], [1.33996,103.94961], [1.33997,103.94963], [1.33998,103.94965], [1.33998,103.94965]]
rawpts = [[1.32614,103.8073],[1.3269,103.80618],[1.32724,103.80568],[1.32737,103.80547],[1.32779,103.80483],[1.32816,103.80428],[1.32856,103.80367],[1.32864,103.80355],[1.32871,103.80342],[1.32878,103.80329],[1.32884,103.80318],[1.32889,103.80307],[1.32892,103.803],[1.32895,103.80294],[1.32908,103.80258],[1.32924,103.80212],[1.32938,103.80173],[1.32946,103.80152],[1.32965,103.801],[1.33007,103.79987],[1.33023,103.79937],[1.33041,103.79884],[1.33063,103.79819],[1.33079,103.79775],[1.3308,103.7977]]
route = []

for i in rawpts:
    g = GeoPoint(i[0],i[1])
    route.append(g)
    
#doc_ref = db.collection(u'vehicles').document(u'7ANPa27tVlmWq5eL8eD2')
#doc_ref.set({u'alertLevel':None,u'alertResponded':False,u'currentLocation':GeoPoint(1.3410458262342566,103.96621654500791)})
#doc_ref = db.collection(u'vehicles').document(u'JD4vfLXkWU3rSqLhUUpI')
#doc_ref.set({u'alertLevel':None,u'alertResponded':False,u'currentLocation':GeoPoint(1.3395486135666554,103.96198737065811)})
#doc_ref = db.collection(u'vehicles').document(u'JqA9shxl85Nof7i6rscf')
#doc_ref.set({u'alertLevel':None,u'alertResponded':False,u'currentLocation':GeoPoint(1.343168836326676,103.95768277260265)})
#doc_ref = db.collection(u'vehicles').document(u'KKIYEiw5Fp1rci2FcCwq')
#doc_ref.set({u'alertLevel':None,u'alertResponded':False,u'currentLocation':GeoPoint(1.3418873993125962,103.9532032014622)})
#doc_ref = db.collection(u'vehicles').document(u'fPz7NgOkva4ZMXZ5pYaR')
#doc_ref.set({u'alertLevel':None,u'alertResponded':False,u'currentLocation':GeoPoint(1.3395902241045166,103.95039053701726)})

#ambulance setup
doc_ref = db.collection(u'ambulances').document(u'oZVhcXl1RvTbnCOslxkqMcP3B772')

#moving ambulance
while len(route) > 1:
    doc_ref.set({u'currentLocation':route[0],u'route':route,u'isActive':True})
    route = route[1:]
    time.sleep(0.2)
    
doc_ref.set({u'currentLocation':route[0],u'route':[],u'isActive':False})